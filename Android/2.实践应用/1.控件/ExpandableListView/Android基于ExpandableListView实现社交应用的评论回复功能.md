åœ¨Androidçš„æ—¥å¸¸å¼€å‘ä¸­ï¼Œè¯„è®ºä¸å›å¤åŠŸèƒ½æ˜¯æˆ‘ä»¬ç»å¸¸é‡åˆ°çš„éœ€æ±‚ä¹‹ä¸€ï¼Œå…¶ä¸­è¯„è®ºä¸å›å¤åˆ—è¡¨çš„å±•ç¤ºä¸€èˆ¬åœ¨åŠŸèƒ½æ¨¡å—ä¸­å æ¯”è¾ƒå¤§ã€‚å¯¹äºéœ€æ±‚æ”¹åŠ¨å’Œè¿­ä»£è¾ƒé¢‘ç¹çš„å…¬å¸æ¥è¯´ï¼Œå¦‚ä½•å¿«é€Ÿå¼€å‘ä¸€ä¸ªäºŒçº§ç•Œé¢æ¥é€‚åº”æˆ‘ä»¬çš„åŠŸèƒ½éœ€æ±‚æ— ç–‘ä¼˜å…ˆçº§æ›´é«˜ä¸€äº›ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä»–ç¤¾äº¤ç±»appçš„è¯„è®ºä¸å›å¤åˆ—è¡¨å¦‚ä½•å±•ç¤ºçš„ï¼š

![](http://ovl7kcyr4.bkt.clouddn.com/18-4-11/21410582.jpg)                          ![](http://ovl7kcyr4.bkt.clouddn.com/18-4-11/25414551.jpg)



Twitterä¸ç”¨è¯´äº†ï¼Œå…¨çƒçŸ¥åç¤¾äº¤å¹³å°ï¼Œä¸Šäº¿ç”¨æˆ·é‡ï¼Œä»–ä»¬çš„è¯„è®ºå›å¤éƒ½åªå±•ç¤ºä¸€çº§æ•°æ®(è¯„è®ºæ•°æ®)ï¼Œå…¶ä»–æ›´å¤šå†…å®¹ï¼ˆå›å¤å†…å®¹ï¼‰ï¼Œæ˜¯éœ€è¦é¡µé¢è·³è½¬å»æŸ¥çœ‹ï¼ŒçŸ¥ä¹ä¹Ÿç±»ä¼¼ã€‚ç¬¬ä¸€å¼ å›¾æ˜¯æˆ‘ä»¬è®¾è®¡ç»™æˆ‘æ‰¾çš„ï¼Œä»–è¯´è¦æŒ‰ç…§è¿™ä¸ªé£æ ¼æ¥ï¼Œå°½é‡å°†è¯„è®ºå’Œå›å¤å†…å®¹åœ¨ä¸€ä¸ªé¡µé¢å±•ç¤ºã€‚å¥½å§ï¼Œæ²¡åŠæ³•ï¼Œæ¯•ç«Ÿæˆ‘ä»¬åšå‰ç«¯çš„ï¼ŒUIè¦çœ‹è®¾è®¡è„¸è‰²ï¼Œæ•°æ®è¦çœ‹åå°è„¸è‰²ğŸ˜‚ã€‚çœ‹åˆ°è®¾è®¡å›¾ï¼Œæˆ‘ä»¬è„‘æµ·è‚¯å®šç¬¬ä¸€æ—¶é—´è”æƒ³ä¸€ä¸‹è§£å†³æ–¹æ¡ˆï¼šç”¨recyclerviewï¼Ÿlistviewï¼Ÿä¸å¯¹ï¼Œåˆ†æä¸€ä¸‹å®ƒçš„å±‚çº§å‘ç°ï¼Œè¯„è®ºæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢çš„å›å¤åˆæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œéš¾é“ç”¨recyclerviewæˆ–è€…listviewçš„åµŒå¥—ï¼ŸæŠ±ç€ä¸ç¡®å®šçš„æ€åº¦ï¼Œç«‹é©¬å»ç½‘ä¸ŠæŸ¥ä¸€ä¸‹ï¼Œæœä¸å…¶ç„¶ï¼Œæœåˆ°çš„å®ç°æ–¹å¼å¤§å¤šéƒ½æ˜¯ç”¨åµŒå¥—å®ç°çš„ï¼Œæ¥å…¬å¸ä¹‹å‰ï¼Œå…¶ä¸­ä¸€ä¸ªé¡¹ç›®é‡Œçš„è¯„è®ºå›å¤åŠŸèƒ½å°±æ˜¯ç”¨çš„åµŒå¥—listviewï¼Œè™½ç„¶å¤„ç†äº†æ»‘åŠ¨å†²çªé—®é¢˜ï¼Œä½†æ•ˆæœä¸ä½³ï¼Œè€Œä¸”æ—¶å¸¸å¡é¡¿ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘è‚¯å®šè¦æ¢ä¸ªæ€è·¯ã€‚



ç½‘ä¸Šè¿˜æœ‰è¯´ç”¨è‡ªå®šä¹‰viewå®ç°çš„ï¼Œä½†æˆ‘å‘ç°å¤§å¤šæ²¡æœ‰å¤„ç†viewçš„å¤ç”¨ï¼Œè€Œä¸”å¼€å‘æˆæœ¬å¤§ï¼Œæš‚æ—¶ä¸äºˆè€ƒè™‘ã€‚é‚£æ€ä¹ˆåŠï¼Ÿæ— æ„ä¸­çœ‹åˆ°expandableè¿™ä¸ªå…³é”®è¯ï¼Œæˆ‘çªç„¶æƒ³åˆ°è°·æ­Œå¾ˆæ—©ä¹‹å‰å‡ºè¿‡ä¸€ä¸ªæ‰©å±•åˆ—è¡¨çš„æ§ä»¶ - ExpandableListViewï¼Œä½†å¬è¯´æ¯”è¾ƒè€ï¼Œå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚ç®—äº†ï¼Œè¯•è¯•å†è¯´ï¼Œé¡ºä¾¿ç†Ÿæ‚‰ä¸€ä¸‹ä»¥å‰åŸºç¡€æ§ä»¶çš„ç”¨æ³•ã€‚

å…ˆæ¥çœ‹ä¸€ä¸‹æœ€ç»ˆçš„æ•ˆæœå›¾å§ï¼š

![](http://ovl7kcyr4.bkt.clouddn.com/18-4-24/18985123.jpg)



è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„æ•ˆæœå›¾ï¼Œä½ å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ¥å®Œå–„å®ƒã€‚å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ•ˆæœå…·ä½“å¦‚ä½•å®ç°çš„å§ã€‚å¤§å®¶åº”è¯¥ä¸éš¾çœ‹å‡ºæ¥ï¼Œé¡µé¢æ•´ä½“é‡‡ç”¨äº†CoordinatorLayoutæ¥å®ç°è¯¦æƒ…é¡µçš„é¡¶éƒ¨è§†å·®æ•ˆã€‚åŒæ—¶ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨ExpandableListViewæ¥å®ç°å¤šçº§åˆ—è¡¨ï¼Œç„¶åå†è§£å†³å®ƒä»¬çš„åµŒå¥—æ»‘åŠ¨é—®é¢˜ã€‚OKï¼Œæˆ‘ä»¬å…ˆä»ExpandableListViewå¼€å§‹åŠ¨æ‰‹ã€‚

## ExpandableListView

å®˜æ–¹å¯¹äºExpandableListViewç»™å‡ºè¿™æ ·çš„è§£é‡Šï¼šA view that shows items in a vertically scrolling two-level list. This differs from the `ListView` by allowing two levels: groups which can individually be expanded to show its children. The items come from the `ExpandableListAdapter` associated with this view.

ç®€å•æ¥è¯´ï¼ŒExpandableListViewæ˜¯ä¸€ä¸ªç”¨äºå‚ç›´æ–¹å‘æ»šåŠ¨çš„äºŒçº§åˆ—è¡¨è§†å›¾ï¼ŒExpandableListViewä¸listviewä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒå¯ä»¥å®ç°äºŒçº§åˆ†ç»„ï¼Œå¹¶é€šè¿‡ExpandableListAdapteræ¥ç»‘å®šæ•°æ®å’Œè§†å›¾ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ä¸€èµ·å®ç°ä¸Šå›¾çš„æ•ˆæœã€‚

### å¸ƒå±€ä¸­å®šä¹‰

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨xmlçš„å¸ƒå±€æ–‡ä»¶ä¸­å£°æ˜ExpandableListViewï¼š

```
<ExpandableListView
    android:id="@+id/detail_page_lv_comment"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:divider="@null"
    android:layout_marginBottom="64dp"
    android:listSelector="@android:color/transparent"
    android:scrollbars="none"/>
```

è¿™é‡Œéœ€è¦è¯´æ˜ä¸¤ä¸ªé—®é¢˜ï¼š

1. ExpandableListViewé»˜è®¤ä¸ºå®ƒçš„itemåŠ ä¸Šäº†ç‚¹å‡»æ•ˆæœï¼Œç”±äºitemé‡Œé¢è¿˜åŒ…å«äº†childItemï¼Œæ‰€ä»¥ï¼Œç‚¹å‡»åï¼Œæ•´ä¸ªitemé‡Œé¢çš„å†…å®¹éƒ½ä¼šæœ‰ç‚¹å‡»æ•ˆæœã€‚æˆ‘ä»¬å¯ä»¥å–æ¶ˆå…¶ç‚¹å‡»ç‰¹æ•ˆï¼Œé¿å…å…¶å½±å“ç”¨æˆ·ä½“éªŒï¼Œåªéœ€è¦è®¾ç½®å¦‚ä¸Šä»£ç ä¸­çš„listSelectorå³å¯ã€‚
2. ExpandableListViewå…·æœ‰é»˜è®¤çš„åˆ†å‰²çº¿ï¼Œå¯ä»¥é€šè¿‡dividerå±æ€§å°†å…¶éšè—ã€‚



### è®¾ç½®Adapter

æ­£å¦‚ä½¿ç”¨listViewé‚£æ ·ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºExpandableListViewè®¾ç½®ä¸€ä¸ªé€‚é…å™¨Adapterï¼Œä¸ºå…¶ç»‘å®šæ•°æ®å’Œè§†å›¾ã€‚ExpandableListViewçš„adapteréœ€è¦ç»§æ‰¿è‡ªExpandableListAdapterï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```
/**
 * Author: Moos
 * E-mail: moosphon@gmail.com
 * Date:  18/4/20.
 * Desc: è¯„è®ºä¸å›å¤åˆ—è¡¨çš„é€‚é…å™¨
 */

public class CommentExpandAdapter extends BaseExpandableListAdapter {
    private static final String TAG = "CommentExpandAdapter";
    private List<CommentDetailBean> commentBeanList;
    private Context context;

    public CommentExpandAdapter(Context context, List<CommentDetailBean> commentBeanList)               {
        this.context = context;
        this.commentBeanList = commentBeanList;
    }

    @Override
    public int getGroupCount() {
        return commentBeanList.size();
    }

    @Override
    public int getChildrenCount(int i) {
        if(commentBeanList.get(i).getReplyList() == null){
            return 0;
        }else {
            return commentBeanList.get(i).getReplyList().size()>0 ? commentBeanList.get(i).getReplyList().size():0;
        }

    }

    @Override
    public Object getGroup(int i) {
        return commentBeanList.get(i);
    }

    @Override
    public Object getChild(int i, int i1) {
        return commentBeanList.get(i).getReplyList().get(i1);
    }

    @Override
    public long getGroupId(int groupPosition) {
        return groupPosition;
    }

    @Override
    public long getChildId(int groupPosition, int childPosition) {
        return getCombinedChildId(groupPosition, childPosition);
    }

    @Override
    public boolean hasStableIds() {
        return true;
    }
    boolean isLike = false;

    @Override
    public View getGroupView(final int groupPosition, boolean isExpand, View convertView, ViewGroup viewGroup) {
        final GroupHolder groupHolder;

        if(convertView == null){
            convertView = LayoutInflater.from(context).inflate(R.layout.comment_item_layout, viewGroup, false);
            groupHolder = new GroupHolder(convertView);
            convertView.setTag(groupHolder);
        }else {
            groupHolder = (GroupHolder) convertView.getTag();
        }
        Glide.with(context).load(R.drawable.user_other)
                .diskCacheStrategy(DiskCacheStrategy.RESULT)
                .error(R.mipmap.ic_launcher)
                .centerCrop()
                .into(groupHolder.logo);
        groupHolder.tv_name.setText(commentBeanList.get(groupPosition).getNickName());
        groupHolder.tv_time.setText(commentBeanList.get(groupPosition).getCreateDate());
        groupHolder.tv_content.setText(commentBeanList.get(groupPosition).getContent());
        groupHolder.iv_like.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                if(isLike){
                    isLike = false;
                    groupHolder.iv_like.setColorFilter(Color.parseColor("#aaaaaa"));
                }else {
                    isLike = true;
                    groupHolder.iv_like.setColorFilter(Color.parseColor("#FF5C5C"));
                }
            }
        });

        return convertView;
    }

    @Override
    public View getChildView(final int groupPosition, int childPosition, boolean b, View convertView, ViewGroup viewGroup) {
        final ChildHolder childHolder;
        if(convertView == null){
            convertView = LayoutInflater.from(context).inflate(R.layout.comment_reply_item_layout,viewGroup, false);
            childHolder = new ChildHolder(convertView);
            convertView.setTag(childHolder);
        }
        else {
            childHolder = (ChildHolder) convertView.getTag();
        }

        String replyUser = commentBeanList.get(groupPosition).getReplyList().get(childPosition).getNickName();
        if(!TextUtils.isEmpty(replyUser)){
            childHolder.tv_name.setText(replyUser + ":");
        }

        childHolder.tv_content.setText(commentBeanList.get(groupPosition).getReplyList().get(childPosition).getContent());

        return convertView;
    }

    @Override
    public boolean isChildSelectable(int i, int i1) {
        return true;
    }

    private class GroupHolder{
        private CircleImageView logo;
        private TextView tv_name, tv_content, tv_time;
        private ImageView iv_like;
        public GroupHolder(View view) {
            logo =  view.findViewById(R.id.comment_item_logo);
            tv_content = view.findViewById(R.id.comment_item_content);
            tv_name = view.findViewById(R.id.comment_item_userName);
            tv_time = view.findViewById(R.id.comment_item_time);
            iv_like = view.findViewById(R.id.comment_item_like);
        }
    }

    private class ChildHolder{
        private TextView tv_name, tv_content;
        public ChildHolder(View view) {
            tv_name = (TextView) view.findViewById(R.id.reply_item_user);
            tv_content = (TextView) view.findViewById(R.id.reply_item_content);
        }
    }

}
```

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰è‡ªå·±çš„ExpandableListAdapteråï¼Œéœ€è¦å®ç°ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š

- æ„é€ æ–¹æ³•ï¼Œè¿™ä¸ªåº”è¯¥æ— éœ€å¤šè¯´äº†ï¼Œä¸€èˆ¬ç”¨æ¥åˆå§‹åŒ–æ•°æ®ç­‰æ“ä½œã€‚
- getGroupCountï¼Œè¿”å›groupåˆ†ç»„çš„æ•°é‡ï¼Œåœ¨å½“å‰éœ€æ±‚ä¸­æŒ‡ä»£è¯„è®ºçš„æ•°é‡ã€‚
- getChildrenCountï¼Œè¿”å›æ‰€åœ¨groupä¸­childçš„æ•°é‡ï¼Œè¿™é‡ŒæŒ‡ä»£å½“å‰è¯„è®ºå¯¹åº”çš„å›å¤æ•°ç›®ã€‚
- getGroupï¼Œè¿”å›groupçš„å®é™…æ•°æ®ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯å½“å‰è¯„è®ºæ•°æ®ã€‚
- getChildï¼Œè¿”å›groupä¸­æŸä¸ªchildçš„å®é™…æ•°æ®ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯å½“å‰è¯„è®ºçš„æŸä¸ªå›å¤æ•°æ®ã€‚
- getGroupIdï¼Œè¿”å›åˆ†ç»„çš„idï¼Œä¸€èˆ¬å°†å½“å‰groupçš„ä½ç½®ä¼ ç»™å®ƒã€‚
- getChildIdï¼Œè¿”å›åˆ†ç»„ä¸­æŸä¸ªchildçš„idï¼Œä¸€èˆ¬ä¹Ÿå°†childå½“å‰ä½ç½®ä¼ ç»™å®ƒï¼Œä¸è¿‡ä¸ºäº†é¿å…é‡å¤ï¼Œå¯ä»¥ä½¿ç”¨`getCombinedChildId(groupPosition, childPosition);`æ¥è·å–idå¹¶è¿”å›ã€‚
- hasStableIdsï¼Œè¡¨ç¤ºåˆ†ç»„å’Œå­é€‰é¡¹æ˜¯å¦æŒæœ‰ç¨³å®šçš„idï¼Œè¿™é‡Œè¿”å›trueå³å¯ã€‚
- isChildSelectableï¼Œè¡¨ç¤ºåˆ†ç»„ä¸­çš„childæ˜¯å¦å¯ä»¥é€‰ä¸­ï¼Œè¿™é‡Œè¿”å›trueã€‚
- getGroupViewï¼Œå³è¿”å›groupçš„è§†å›¾ï¼Œä¸€èˆ¬åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›æ•°æ®å’Œè§†å›¾ç»‘å®šçš„å·¥ä½œï¼Œä¸€èˆ¬ä¸ºäº†å¤ç”¨å’Œé«˜æ•ˆï¼Œå¯ä»¥è‡ªå®šä¹‰ViewHolderï¼Œç”¨æ³•ä¸listviewä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚
- getChildViewï¼Œè¿”å›åˆ†ç»„ä¸­childå­é¡¹çš„è§†å›¾ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å½“å‰groupæ‰€åœ¨çš„ä½ç½®ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å½“å‰childæ‰€åœ¨ä½ç½®ã€‚



è¿™é‡Œçš„æ•°æ®æ˜¯æˆ‘è‡ªå·±åšçš„æ¨¡æ‹Ÿæ•°æ®ï¼Œä¸è¿‡åº”è¯¥ç®—æ˜¯è¾ƒä¸ºé€šç”¨çš„æ ¼å¼äº†ï¼Œå¤§ä½“æ ¼å¼å¦‚ä¸‹ï¼š

![æ•°æ®æ ¼å¼](http://ovl7kcyr4.bkt.clouddn.com/18-4-24/70716804.jpg)

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åå°ä¼šé€šè¿‡æ¥å£è¿”å›ç»™æˆ‘ä»¬ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¦‚æœæƒ³è¦æŸ¥çœ‹æ›´å¤šè¯„è®ºï¼Œéœ€è¦è·³è½¬åˆ°â€œæ›´å¤šé¡µé¢â€å»æŸ¥çœ‹ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬åªè€ƒè™‘åŠ è½½éƒ¨åˆ†æ•°æ®ã€‚



### Activityä¸­ä½¿ç”¨

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨activityä¸­æ˜¾ç¤ºè¯„è®ºå’Œå›å¤çš„äºŒçº§åˆ—è¡¨äº†ï¼š

```
private ExpandableListView expandableListView;
private CommentExpandAdapter adapter;
private CommentBean commentBean;
private List<CommentDetailBean> commentsList;

...

@Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        initView();
    }

    private void initView() {
       
        expandableListView = findViewById(R.id.detail_page_lv_comment);
        initExpandableListView(commentsList);
    }

    /**
     * åˆå§‹åŒ–è¯„è®ºå’Œå›å¤åˆ—è¡¨
     */
    private void initExpandableListView(final List<CommentDetailBean> commentList){
        expandableListView.setGroupIndicator(null);
        //é»˜è®¤å±•å¼€æ‰€æœ‰å›å¤
        adapter = new CommentExpandAdapter(this, commentList);
        expandableListView.setAdapter(adapter);
        for(int i = 0; i<commentList.size(); i++){
            expandableListView.expandGroup(i);
        }
        expandableListView.setOnGroupClickListener(new ExpandableListView.OnGroupClickListener() {
            @Override
            public boolean onGroupClick(ExpandableListView expandableListView, View view, int groupPosition, long l) {
                boolean isExpanded = expandableListView.isGroupExpanded(groupPosition);
                Log.e(TAG, "onGroupClick: å½“å‰çš„è¯„è®ºid>>>"+commentList.get(groupPosition).getId());
                
//                if(isExpanded){
//                    expandableListView.collapseGroup(groupPosition);
//                }else {
//                    expandableListView.expandGroup(groupPosition, true);
//                }
              
                return true;
            }
        });

        expandableListView.setOnChildClickListener(new ExpandableListView.OnChildClickListener() {
            @Override
            public boolean onChildClick(ExpandableListView expandableListView, View view, int groupPosition, int childPosition, long l) {
                Toast.makeText(MainActivity.this,"ç‚¹å‡»äº†å›å¤",Toast.LENGTH_SHORT).show();
                return false;
            }
        });

        expandableListView.setOnGroupExpandListener(new ExpandableListView.OnGroupExpandListener() {
            @Override
            public void onGroupExpand(int groupPosition) {
                //toast("å±•å¼€ç¬¬"+groupPosition+"ä¸ªåˆ†ç»„");

            }
        });

    }

    /**
     * by moos on 2018/04/20
     * func:ç”Ÿæˆæµ‹è¯•æ•°æ®
     * @return è¯„è®ºæ•°æ®
     */
    private List<CommentDetailBean> generateTestData(){
        Gson gson = new Gson();
        commentBean = gson.fromJson(testJson, CommentBean.class);
        List<CommentDetailBean> commentList = commentBean.getData().getList();
        return commentList;
    }

```

å°±ä»¥ä¸Šä»£ç ä½œä¸€ä¸‹ç®€å•è¯´æ˜ï¼š

1. ExpandableListViewåœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šä¸ºæˆ‘ä»¬è‡ªå¸¦åˆ†ç»„çš„iconï¼ˆâ–¶ï¸ï¼‰ï¼Œå½“å‰éœ€æ±‚ä¸‹ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦å±•ç¤ºï¼Œå¯ä»¥é€šè¿‡`expandableListView.setGroupIndicator(null)`æ¥éšè—ã€‚

2. ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦é»˜è®¤å±•å¼€æ‰€æœ‰çš„åˆ†ç»„ï¼Œæˆ‘å°±å¯ä»¥é€šè¿‡å¾ªç¯æ¥è°ƒç”¨`expandableListView.expandGroup(i);`æ–¹æ³•ã€‚

3. ExpandableListViewä¸ºæˆ‘ä»¬æä¾›äº†groupå’Œchildçš„ç‚¹å‡»äº‹ä»¶ï¼Œåˆ†åˆ«é€šè¿‡`setOnGroupClickListener`å’Œ`setOnChildClickListener`æ¥è®¾ç½®ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œgroupçš„ç‚¹å‡»äº‹ä»¶é‡Œå¦‚æœæˆ‘ä»¬è¿”å›çš„æ˜¯falseï¼Œé‚£ä¹ˆæˆ‘ä»¬ç‚¹å‡»groupå°±ä¼šè‡ªåŠ¨å±•å¼€ï¼Œä½†æˆ‘è¿™é‡Œç¢°åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘è¿”å›falseæ—¶ï¼Œç¬¬ä¸€æ¡è¯„è®ºæ•°æ®ä¼šå¤šå‡ºä¸€æ¡ã€‚é€šè¿‡ç™¾åº¦æŸ¥æ‰¾æ–¹æ³•ï¼Œè™½ç„¶å¾ˆå¤šç±»ä¼¼é—®é¢˜ï¼Œä½†ç»ˆç©¶æ²¡æœ‰è§£å†³ï¼Œæœ€åæˆ‘è¿”å›äº†tureï¼Œå¹¶é€šè¿‡ä»¥ä¸‹ä»£ç æ‰‹åŠ¨å±•å¼€å’Œæ”¶ç¼©å°±å¯ä»¥äº†ï¼š

   ```
   if(isExpanded){
       expandableListView.collapseGroup(groupPosition);
   }else {
       expandableListView.expandGroup(groupPosition, true);
   }
   ```

4. æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡`setOnGroupExpandListener`å’Œ`setOnGroupCollapseListener`æ¥ç›‘å¬ExpandableListViewçš„åˆ†ç»„å±•å¼€å’Œæ”¶ç¼©çš„çŠ¶æ€ã€‚

### è¯„è®ºå’Œå›å¤åŠŸèƒ½

ä¸ºäº†æ¨¡æ‹Ÿæ•´ä¸ªè¯„è®ºå’Œå›å¤åŠŸèƒ½ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‰‹åŠ¨æ’å…¥æ”¶æ®å¹¶åˆ·æ–°æ•°æ®åˆ—è¡¨ã€‚è¿™é‡Œæˆ‘å°±ç®€å•åšä¸€ä¸‹æ¨¡æ‹Ÿï¼Œè¯·å¿½ç•¥ä¸€äº›UIä¸Šçš„ç»†èŠ‚ã€‚

#### æ’å…¥è¯„è®ºæ•°æ®

æ’å…¥è¯„è®ºæ•°æ®æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨listä¸­æ’å…¥ä¸€æ¡æ•°æ®å¹¶åˆ·æ–°å³å¯ï¼š

```
String commentContent = commentText.getText().toString().trim();
if(!TextUtils.isEmpty(commentContent)){

    //commentOnWork(commentContent);
    dialog.dismiss();
    CommentDetailBean detailBean = new CommentDetailBean("å°æ˜", commentContent,"åˆšåˆš");
    adapter.addTheCommentData(detailBean);
    Toast.makeText(MainActivity.this,"è¯„è®ºæˆåŠŸ",Toast.LENGTH_SHORT).show();

}else {
    Toast.makeText(MainActivity.this,"è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º",Toast.LENGTH_SHORT).show();
}
```

adapterä¸­çš„addTheCommentDataæ–¹æ³•å¦‚ä¸‹ï¼š

```
/**
 * by moos on 2018/04/20
 * func:è¯„è®ºæˆåŠŸåæ’å…¥ä¸€æ¡æ•°æ®
 * @param commentDetailBean æ–°çš„è¯„è®ºæ•°æ®
 */
public void addTheCommentData(CommentDetailBean commentDetailBean){
    if(commentDetailBean!=null){

        commentBeanList.add(commentDetailBean);
        notifyDataSetChanged();
    }else {
        throw new IllegalArgumentException("è¯„è®ºæ•°æ®ä¸ºç©º!");
    }

}
```

ä»£ç æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå°±ä¸å¤šåšè¯´æ˜äº†ã€‚

#### æ’å…¥å›å¤æ•°æ®

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®ç°ç‚¹å‡»æŸä¸€æ¡è¯„è®ºï¼Œç„¶å`@ta`,é‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨groupçš„ç‚¹å‡»äº‹ä»¶é‡Œå¼¹èµ·å›å¤æ¡†ï¼š

```
expandableListView.setOnGroupClickListener(new ExpandableListView.OnGroupClickListener() {
            @Override
            public boolean onGroupClick(ExpandableListView expandableListView, View view, int groupPosition, long l) {
   
                showReplyDialog(groupPosition);
                return true;
            }
        });
        
......

/**
     * by moos on 2018/04/20
     * func:å¼¹å‡ºå›å¤æ¡†
     */
    private void showReplyDialog(final int position){
        dialog = new BottomSheetDialog(this);
        View commentView = LayoutInflater.from(this).inflate(R.layout.comment_dialog_layout,null);
        final EditText commentText = (EditText) commentView.findViewById(R.id.dialog_comment_et);
        final Button bt_comment = (Button) commentView.findViewById(R.id.dialog_comment_bt);
        commentText.setHint("å›å¤ " + commentsList.get(position).getNickName() + " çš„è¯„è®º:");
        dialog.setContentView(commentView);
        bt_comment.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                String replyContent = commentText.getText().toString().trim();
                if(!TextUtils.isEmpty(replyContent)){

                    dialog.dismiss();
                    ReplyDetailBean detailBean = new ReplyDetailBean("å°çº¢",replyContent);
                    adapter.addTheReplyData(detailBean, position);
                    Toast.makeText(MainActivity.this,"å›å¤æˆåŠŸ",Toast.LENGTH_SHORT).show();
                }else {
                    Toast.makeText(MainActivity.this,"å›å¤å†…å®¹ä¸èƒ½ä¸ºç©º",Toast.LENGTH_SHORT).show();
                }
            }
        });
        commentText.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence charSequence, int i, int i1, int i2) {

            }

            @Override
            public void onTextChanged(CharSequence charSequence, int i, int i1, int i2) {
                if(!TextUtils.isEmpty(charSequence) && charSequence.length()>2){
                    bt_comment.setBackgroundColor(Color.parseColor("#FFB568"));
                }else {
                    bt_comment.setBackgroundColor(Color.parseColor("#D8D8D8"));
                }
            }

            @Override
            public void afterTextChanged(Editable editable) {

            }
        });
        dialog.show();
    }

```

æ’å…¥å›å¤çš„æ•°æ®ä¸ä¸Šé¢æ’å…¥è¯„è®ºç±»ä¼¼ï¼Œè¿™é‡Œè´´ä¸€ä¸‹adapterä¸­çš„ä»£ç ï¼š

```
/**
 * by moos on 2018/04/20
 * func:å›å¤æˆåŠŸåæ’å…¥ä¸€æ¡æ•°æ®
 * @param replyDetailBean æ–°çš„å›å¤æ•°æ®
 */
public void addTheReplyData(ReplyDetailBean replyDetailBean, int groupPosition){
    if(replyDetailBean!=null){
        Log.e(TAG, "addTheReplyData: >>>>è¯¥åˆ·æ–°å›å¤åˆ—è¡¨äº†:"+replyDetailBean.toString() );
        if(commentBeanList.get(groupPosition).getReplyList() != null ){
            commentBeanList.get(groupPosition).getReplyList().add(replyDetailBean);
        }else {
            List<ReplyDetailBean> replyList = new ArrayList<>();
            replyList.add(replyDetailBean);
            commentBeanList.get(groupPosition).setReplyList(replyList);
        }
        notifyDataSetChanged();
    }else {
        throw new IllegalArgumentException("å›å¤æ•°æ®ä¸ºç©º!");
    }

}
```

éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œç”±äºä¸ä¸€å®šæ‰€æœ‰çš„è¯„è®ºéƒ½æœ‰å›å¤æ•°æ®ï¼Œæ‰€ä»¥åœ¨æ’å…¥æ•°æ®å‰æˆ‘ä»¬è¦åˆ¤æ–­ReplyListæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œç›´æ¥è·å–å½“å‰è¯„è®ºçš„å›å¤åˆ—è¡¨ï¼Œå¹¶æ’å…¥æ•°æ®ï¼›å¦‚æœä¸ºç©ºï¼Œéœ€è¦newä¸€ä¸ªReplyListï¼Œæ’å…¥æ•°æ®åè¿˜è¦ä¸ºè¯„è®ºsetä¸€ä¸‹ReplyListã€‚

## è§£å†³CoordinatorLayoutä¸ExpandableListViewåµŒå¥—é—®é¢˜

å¦‚æœä½ ä¸éœ€è¦ä½¿ç”¨CoordinatorLayoutæˆ–è€…NestedScrollViewï¼Œå¯ä»¥è·³è¿‡æœ¬å°èŠ‚ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬äº§å“ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œè¿˜éœ€è¦æˆ‘ä»¬åŠ ä¸Šç±»ä¼¼çš„é¡¶éƒ¨è§†å·®æ•ˆæœæˆ–è€…ä¸‹æ‹‰åˆ·æ–°ç­‰ï¼Œè¿™å°±è¦æˆ‘ä»¬å¤„ç†ä¸€äº›å¸¸è§çš„åµŒå¥—æ»‘åŠ¨é—®é¢˜äº†ã€‚

ç”±äºCoordinatorLayoutå®ç°NestedScrollingParentæ¥å£,RecycleViewå®ç°äº†NestedScrollingChildæ¥å£,æ‰€ä»¥å°±å¯ä»¥åœ¨NestedScrollingChildHelperçš„å¸®åŠ©ä¸‹å®ç°åµŒå¥—æ»‘åŠ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„ExpandableListViewå®ç°NestedScrollingChildæ¥å£æ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼š

```
/**
 * Author: Moos
 * E-mail: moosphon@gmail.com
 * Date:  18/4/20.
 * Desc: è‡ªå®šä¹‰ExpandableListView,è§£å†³ä¸CoordinatorLayoutæ»‘åŠ¨å†²çªé—®é¢˜
 */

public class CommentExpandableListView extends ExpandableListView implements NestedScrollingChild{
    private NestedScrollingChildHelper mScrollingChildHelper;


    public CommentExpandableListView(Context context, AttributeSet attrs) {
        super(context, attrs);
        mScrollingChildHelper = new NestedScrollingChildHelper(this);
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
            setNestedScrollingEnabled(true);
        }

    }


    @Override
    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        int expandSpec = MeasureSpec.makeMeasureSpec(Integer.MAX_VALUE >> 2, MeasureSpec.AT_MOST);
        super.onMeasure(widthMeasureSpec, expandSpec);

    }

    @Override
    public void setNestedScrollingEnabled(boolean enabled) {
        mScrollingChildHelper.setNestedScrollingEnabled(enabled);
    }

    @Override
    public boolean isNestedScrollingEnabled() {
        return mScrollingChildHelper.isNestedScrollingEnabled();
    }

    @Override
    public boolean startNestedScroll(int axes) {
        return mScrollingChildHelper.startNestedScroll(axes);
    }

    @Override
    public void stopNestedScroll() {
        mScrollingChildHelper.stopNestedScroll();
    }

    @Override
    public boolean hasNestedScrollingParent() {
        return mScrollingChildHelper.hasNestedScrollingParent();
    }

    @Override
    public boolean dispatchNestedScroll(int dxConsumed, int dyConsumed, int dxUnconsumed,
                                        int dyUnconsumed, int[] offsetInWindow) {
        return mScrollingChildHelper.dispatchNestedScroll(dxConsumed, dyConsumed,
                dxUnconsumed, dyUnconsumed, offsetInWindow);
    }

    @Override
    public boolean dispatchNestedPreScroll(int dx, int dy, int[] consumed, int[] offsetInWindow) {
        return mScrollingChildHelper.dispatchNestedPreScroll(dx, dy, consumed, offsetInWindow);
    }

    @Override
    public boolean dispatchNestedFling(float velocityX, float velocityY, boolean consumed) {
        return mScrollingChildHelper.dispatchNestedFling(velocityX, velocityY, consumed);
    }

    @Override
    public boolean dispatchNestedPreFling(float velocityX, float velocityY) {
        return mScrollingChildHelper.dispatchNestedPreFling(velocityX, velocityY);
    }
}
```

ä»£ç å°±ä¸è§£é‡Šäº†ï¼Œæ¯•ç«Ÿè¿™ä¸æ˜¯æœ¬ç¯‡æ–‡ç« ç­‰é‡ç‚¹ï¼Œå¤§å®¶å¯ä»¥å»ç½‘ä¸ŠæŸ¥é˜…NestedScrollViewç›¸å…³æ–‡ç« æˆ–è€…æºç å»å¯¹ç…§ç†è§£ã€‚

å®Œæ•´çš„å¸ƒå±€ä»£ç æ¯”è¾ƒå¤šï¼Œè¿™é‡Œå°±ä¸è´´äº†ï¼Œå¤§å®¶å¯ä»¥å»githubä¸Šé¢æŸ¥çœ‹ï¼š<https://github.com/Moosphan/CommentWithReplyView-master>